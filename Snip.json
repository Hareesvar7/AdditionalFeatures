{
    "Enforce S3 Access Points in VPC Only": {
        "prefix": "s3AccessPointInVPC",
        "body": [
            "deny[msg] {",
            "    resource := input.resource_changes[_]",
            "    resource.type == \"aws_s3_access_point\"",
            "    not resource.change.after.vpc_configuration",
            "    msg = sprintf(\"S3 Access Point '%s' must be configured in a VPC\", [resource.change.after.name])",
            "}"
        ],
        "description": "Enforce that S3 access points are only configured in a VPC."
    },
    "Enforce Public Access Blocks on S3 Access Points": {
        "prefix": "publicAccessBlocks",
        "body": [
            "deny[msg] {",
            "    resource := input.resource_changes[_]",
            "    resource.type == \"aws_s3_access_point\"",
            "    not resource.change.after.public_access_block",
            "    msg = sprintf(\"S3 Access Point '%s' must have public access blocks enabled\", [resource.change.after.name])",
            "}"
        ],
        "description": "Enforce that S3 access points must have public access blocks enabled."
    },
    "Enforce Account-Level Public Access Blocks": {
        "prefix": "accountLevelPublicAccess",
        "body": [
            "deny[msg] {",
            "    resource := input.resource_changes[_]",
            "    resource.type == \"aws_s3_bucket\"",
            "    not resource.change.after.account_level_public_access_block",
            "    msg = sprintf(\"S3 bucket '%s' must have account-level public access blocks enabled\", [resource.change.after.bucket])",
            "}"
        ],
        "description": "Enforce that S3 buckets must have account-level public access blocks enabled."
    },
    "Prohibit ACLs on S3 Buckets": {
        "prefix": "prohibitACLs",
        "body": [
            "deny[msg] {",
            "    resource := input.resource_changes[_]",
            "    resource.type == \"aws_s3_bucket\"",
            "    resource.change.after.acl != \"private\"",
            "    msg = sprintf(\"S3 bucket '%s' must not use ACLs\", [resource.change.after.bucket])",
            "}"
        ],
        "description": "Prohibit the use of ACLs on S3 buckets."
    },
    "Prohibit Blacklisted Actions on S3 Buckets": {
        "prefix": "blacklistedActions",
        "body": [
            "deny[msg] {",
            "    resource := input.resource_changes[_]",
            "    resource.type == \"aws_s3_bucket\"",
            "    action := resource.change.after.blacklisted_actions[_]",
            "    msg = sprintf(\"S3 bucket '%s' contains blacklisted action '%s'\", [resource.change.after.bucket, action])",
            "}"
        ],
        "description": "Prohibit specific blacklisted actions on S3 buckets."
    }
}
